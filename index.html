<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wealth Monitor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Luxury Light Theme Palette */
            --bg-color: #FDFBF7;
            /* Creamy White */
            --card-bg: #FFFFFF;
            --text-primary: #1C1917;
            /* Warm Charcoal */
            --text-secondary: #57534E;
            /* Stone Gray */
            --accent-primary: #0F172A;
            /* Deep Navy */
            --accent-secondary: #B45309;
            /* Burnished Gold */
            --accent-green: #059669;
            /* Emerald */
            --accent-red: #DC2626;
            /* Deep Red */
            --accent-blue: #0F172A;
            /* Navy (replacing bright blue) */
            --border-color: #E7E5E4;
            /* Warm Light Gray */
            --glass-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05), 0 10px 15px -3px rgba(0, 0, 0, 0.02);
            --font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: var(--font-family);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 1rem;
            /* Reduced padding for mobile */
            /* Subtle texture or very soft gradient */
            background-image:
                radial-gradient(at 0% 0%, rgba(180, 83, 9, 0.03) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(15, 23, 42, 0.03) 0px, transparent 50%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        header {
            margin-bottom: 2rem;
            display: flex;
            flex-direction: column;
            /* Stack on mobile */
            gap: 1rem;
            align-items: flex-start;
        }

        @media (min-width: 640px) {
            header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }

        h1 {
            font-weight: 700;
            letter-spacing: -0.03em;
            color: var(--accent-primary);
            font-size: 1.75rem;
        }

        h3 {
            color: var(--accent-primary);
            font-weight: 600;
            font-size: 1.1rem;
            letter-spacing: -0.01em;
        }

        /* Dashboard Grid - Mobile First (1 col) */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        @media (min-width: 768px) {
            .dashboard {
                grid-template-columns: repeat(3, 1fr);
                gap: 1.5rem;
            }
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            /* 16px */
            padding: 1.25rem;
            box-shadow: var(--glass-shadow);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.01);
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .metric-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--accent-primary);
            letter-spacing: -0.02em;
        }

        .net-worth {
            color: var(--accent-primary);
        }

        .assets-val {
            color: var(--accent-green);
        }

        .liabilities-val {
            color: var(--accent-red);
        }

        /* Content Area - Mobile First (Stack) */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        @media (min-width: 1024px) {
            .content-grid {
                grid-template-columns: 2fr 1fr;
            }
        }

        /* Forms & List */
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        @media (min-width: 640px) {
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-grid .full-width {
                grid-column: span 2;
            }
        }

        @media (min-width: 1024px) {

            /* Original layout for desktop form if preferred, or keep grid */
            .form-grid {
                grid-template-columns: 2fr 1fr 1fr 1fr 2fr auto;
                align-items: end;
            }

            .form-grid .full-width {
                grid-column: auto;
            }
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .input-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        input,
        select {
            width: 100%;
            background: #F8FAFC;
            /* Very light cool gray */
            border: 1px solid var(--border-color);
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            color: var(--text-primary);
            outline: none;
            transition: all 0.2s;
            font-size: 0.95rem;
        }

        input:focus,
        select:focus {
            border-color: var(--accent-secondary);
            /* Gold focus */
            background: #FFFFFF;
            box-shadow: 0 0 0 3px rgba(180, 83, 9, 0.1);
        }

        .btn {
            width: 100%;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary {
            background: var(--accent-primary);
            /* Navy */
            color: white;
        }

        .btn-primary:hover {
            background: #1e293b;
            /* Lighter Navy */
            transform: translateY(-1px);
        }

        .items-list {
            list-style: none;
            max-height: 500px;
            overflow-y: auto;
        }

        .item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #FAFAF9;
            /* Warm gray bg for items */
            margin-bottom: 0.75rem;
            border-radius: 0.75rem;
            border: 1px solid transparent;
            transition: background-color 0.2s;
        }

        .item:hover {
            background: #F3F4F6;
        }

        .item.asset {
            border-left: 4px solid var(--accent-green);
        }

        .item.liability {
            border-left: 4px solid var(--accent-red);
        }

        .item-info h4 {
            font-size: 0.95rem;
            color: var(--text-primary);
            font-weight: 600;
        }

        .item-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .btn-icon {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.1rem;
            padding: 0.25rem;
            border-radius: 4px;
            transition: color 0.2s, background 0.2s;
        }

        .btn-icon:hover {
            color: var(--accent-primary);
            background: rgba(0, 0, 0, 0.05);
        }

        .btn-delete:hover {
            color: var(--accent-red);
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        /* Projections Grid */
        .projections-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        @media (min-width: 1024px) {
            .projections-grid {
                grid-template-columns: 2fr 1fr;
            }
        }
    </style>
</head>

<body>

    <div class="container animate-in">
        <header>
            <h1>WealthVault</h1>
            <div style="display:flex; gap:0.5rem;">
                <button onclick="app.openSettings()"
                    style="background:transparent; border:1px solid var(--border-color); color:var(--text-secondary); padding:0.5rem 1rem; border-radius:0.5rem; cursor:pointer;"
                    title="Settings">⚙️</button>
                <button onclick="app.exportToCSV()"
                    style="background:var(--accent-blue); border:none; color:white; padding:0.5rem 1rem; border-radius:0.5rem; cursor:pointer; font-weight:600;">Download
                    CSV</button>
                <button onclick="app.resetData()"
                    style="background:transparent; border:1px solid var(--border-color); color:var(--text-secondary); padding:0.5rem 1rem; border-radius:0.5rem; cursor:pointer;">Reset
                    Data</button>
            </div>
        </header>

        <!-- Settings Modal -->
        <div id="settings-modal"
            style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; align-items:center; justify-content:center;">
            <div class="card"
                style="width:90%; max-width:500px; background:var(--bg-color); border:1px solid var(--border-color);">
                <div class="panel-header">
                    <h3>Data Sync</h3>
                    <button onclick="app.closeSettings()"
                        style="background:transparent; border:none; color:var(--text-secondary); font-size:1.5rem; cursor:pointer;">&times;</button>
                </div>
                <p style="margin-bottom:1rem; color:var(--text-secondary); font-size:0.9rem;">
                    Sync your data with the connected Google Sheet.
                </p>
                <div style="display:flex; gap:1rem; align-items:center;">
                    <button onclick="app.manualSync()" class="btn btn-primary">Sync Now</button>
                    <span id="sync-status" style="font-size:0.875rem; color:var(--text-secondary);"></span>
                </div>
            </div>
        </div>

        <div class="dashboard">
            <div class="card">
                <div class="metric-label">Net Worth</div>
                <div class="metric-value net-worth" id="display-net-worth">$0.00</div>
            </div>
            <div class="card">
                <div class="metric-label">Total Assets</div>
                <div class="metric-value assets-val" id="display-assets">$0.00</div>
            </div>
            <div class="card">
                <div class="metric-label">Total Liabilities</div>
                <div class="metric-value liabilities-val" id="display-liabilities">$0.00</div>
            </div>
        </div>

        <!-- Projections Section -->
        <div class="card" style="margin-bottom: 2rem;">
            <div class="panel-header" style="margin-bottom: 1rem; border-bottom: none;">
                <h3>Projected Net Worth (10 Years)</h3>
                <div style="font-size:0.875rem; color:var(--text-secondary);">Estimated growth based on current rates
                </div>
            </div>

            <div class="projections-grid">
                <div class="chart-container" style="height: 350px;">
                    <canvas id="projectionChart"></canvas>
                </div>
                <div>
                    <table style="width: 100%; text-align: left; border-collapse: collapse; font-size: 0.9rem;">
                        <thead>
                            <tr style="color: var(--text-secondary); border-bottom: 1px solid var(--border-color);">
                                <th style="padding: 0.5rem 0;">Year</th>
                                <th style="padding: 0.5rem 0; text-align: right;">Net Worth</th>
                                <th style="padding: 0.5rem 0; text-align: right;">Growth</th>
                            </tr>
                        </thead>
                        <tbody id="projection-table-body">
                            <!-- Rows injected by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="content-grid">
            <!-- Main Panel: List & Form -->
            <div class="card">
                <div class="panel-header">
                    <h3>Portfolio Items</h3>
                    <div style="font-size:0.875rem; color:var(--text-secondary);">Manage your assets & liabilities</div>
                </div>

                <form id="add-item-form" class="form-grid">
                    <div class="input-group full-width">
                        <label class="input-label" for="input-name">Item Name</label>
                        <input type="text" id="input-name" placeholder="e.g., Home, Tesla Stock" required>
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="input-value">Value</label>
                        <input type="number" id="input-value" placeholder="0.00" min="0" step="0.01" required>
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="input-rate">Interest Rate</label>
                        <input type="number" id="input-rate" placeholder="0%" step="0.01">
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="input-type">Type</label>
                        <select id="input-type">
                            <option value="asset">Asset</option>
                            <option value="liability">Liability</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="input-category">Category</label>
                        <select id="input-category">
                            <option value="Savings Account">Savings Account</option>
                            <option value="Fixed Deposit (FD)">Fixed Deposit (FD)</option>
                            <option value="Recurring Deposit (RD)">Recurring Deposit (RD)</option>
                            <option value="EPF">EPF (Employee Provident Fund)</option>
                            <option value="PPF">PPF (Public Provident Fund)</option>
                            <option value="NPS">NPS (National Pension System)</option>
                            <option value="Mutual Funds">Mutual Funds</option>
                            <option value="Stocks">Stocks</option>
                            <option value="Real Estate">Real Estate</option>
                            <option value="Gold / Silver">Gold / Silver</option>
                            <option value="Crypto">Crypto</option>
                            <option value="Cash">Cash</option>
                            <option value="Loan / Debt">Loan / Debt</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div style="display:flex; gap:0.5rem; padding-bottom: 0.1rem; align-items: flex-end;">
                        <button type="submit" id="btn-submit" class="btn btn-primary" style="width: 100%;">Add
                            Item</button>
                        <button type="button" id="btn-cancel" class="btn"
                            style="width: 100px; background: transparent; border: 1px solid var(--border-color); color: var(--text-secondary); display: none;">Cancel</button>
                    </div>
                </form>

                <ul class="items-list" id="items-list">
                    <!-- Items will be injected here -->
                </ul>
            </div>

            <!-- Side Panel: Visuals -->
            <div class="card">
                <div class="panel-header">
                    <h3>Allocation</h3>
                </div>
                <div class="chart-container">
                    <canvas id="wealthChart"></canvas>
                </div>
                <div style="margin-top: 2rem;">
                    <h4 style="margin-bottom: 1rem; color: var(--text-secondary); font-size: 0.875rem;">INSIGHTS</h4>
                    <p id="insight-text" style="font-size: 0.9rem; line-height: 1.5; color: var(--text-secondary);">
                        Add items to see your wealth distribution.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        class WealthApp {
            constructor() {
                this.items = JSON.parse(localStorage.getItem('wealth_items')) || [];
                // Hardcoded URL as per user request
                this.scriptURL = 'https://script.google.com/macros/s/AKfycbwvNwUfR4UedBaR1aJeGDQrlMh0E8fUlLjoi8OqVKRFkJ2W14UU4XDzze7c_b2LwsvvWg/exec';
                this.editingId = null;
                this.chart = null;
                this.currencyFormatter = new Intl.NumberFormat('en-IN', {
                    style: 'currency',
                    currency: 'INR',
                    maximumFractionDigits: 0
                });
                this.init();
            }

            init() {
                this.cacheDOM();
                this.bindEvents();
                this.render();

                // Initial Sync if URL exists
                if (this.scriptURL) {
                    this.pullFromSheet();
                }
            }

            cacheDOM() {
                this.dom = {
                    form: document.getElementById('add-item-form'),
                    nameInput: document.getElementById('input-name'),
                    valueInput: document.getElementById('input-value'),
                    rateInput: document.getElementById('input-rate'),
                    typeInput: document.getElementById('input-type'),
                    categoryInput: document.getElementById('input-category'),
                    submitBtn: document.getElementById('btn-submit'),
                    cancelBtn: document.getElementById('btn-cancel'),
                    list: document.getElementById('items-list'),
                    netWorth: document.getElementById('display-net-worth'),
                    assets: document.getElementById('display-assets'),
                    liabilities: document.getElementById('display-liabilities'),
                    chartCanvas: document.getElementById('wealthChart'),
                    insightText: document.getElementById('insight-text'),
                    projChartCanvas: document.getElementById('projectionChart'),
                    projTableBody: document.getElementById('projection-table-body'),
                    // Settings
                    settingsModal: document.getElementById('settings-modal'),
                    syncStatus: document.getElementById('sync-status')
                };
            }

            bindEvents() {
                this.dom.form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveItem();
                });

                this.dom.cancelBtn.addEventListener('click', () => {
                    this.cancelEdit();
                });
            }

            // --- Settings & Sync ---

            openSettings() {
                this.dom.settingsModal.style.display = 'flex';
                this.dom.syncStatus.textContent = '';
            }

            closeSettings() {
                this.dom.settingsModal.style.display = 'none';
            }

            manualSync() {
                if (this.scriptURL) {
                    this.dom.syncStatus.textContent = 'Syncing...';
                    this.pullFromSheet().then(() => {
                        this.dom.syncStatus.textContent = 'Sync Complete!';
                        setTimeout(() => this.closeSettings(), 1500);
                    }).catch(err => {
                        this.dom.syncStatus.textContent = 'Sync Failed: ' + err.message;
                    });
                }
            }

            async pullFromSheet() {
                if (!this.scriptURL) return;
                try {
                    const res = await fetch(this.scriptURL);
                    const data = await res.json();
                    if (Array.isArray(data) && data.length > 0) {
                        // Merge or Overwrite? For simplicity, we'll overwrite local if cloud has data
                        // In a real app, we'd do conflict resolution.
                        // Here, we assume Cloud is source of truth if connected.
                        // However, to be safe, let's only overwrite if local is empty OR user explicitly requested sync
                        // For now, let's just overwrite local with cloud data to ensure "Live DB" feel
                        this.items = data;
                        this.save(true); // Save to local but skip push to avoid loop
                        this.render();
                        console.log('Pulled from sheet:', data.length, 'items');
                    }
                } catch (e) {
                    console.error('Pull failed', e);
                    alert('Failed to pull data from Google Sheet. Check URL.');
                }
            }

            async pushToSheet() {
                if (!this.scriptURL) return;
                try {
                    // Send as text/plain to avoid CORS preflight issues with GAS
                    await fetch(this.scriptURL, {
                        method: 'POST',
                        body: JSON.stringify({ items: this.items })
                    });
                    console.log('Pushed to sheet');
                } catch (e) {
                    console.error('Push failed', e);
                }
            }

            // --- Item Management ---

            saveItem() {
                const name = this.dom.nameInput.value;
                const value = parseFloat(this.dom.valueInput.value);
                const rate = parseFloat(this.dom.rateInput.value) || 0;
                const type = this.dom.typeInput.value;
                const category = this.dom.categoryInput.value;

                if (name && !isNaN(value)) {
                    if (this.editingId) {
                        // Update existing item
                        const index = this.items.findIndex(item => item.id === this.editingId);
                        if (index !== -1) {
                            this.items[index] = {
                                ...this.items[index],
                                name,
                                value,
                                rate,
                                type,
                                category,
                                date: new Date().toISOString()
                            };
                        }
                        this.cancelEdit(); // Reset form and mode
                    } else {
                        // Add new item
                        const item = {
                            id: Date.now(),
                            name,
                            value,
                            rate,
                            type,
                            category,
                            date: new Date().toISOString()
                        };
                        this.items.push(item);
                        this.dom.form.reset();
                    }

                    this.save();
                    this.render();
                }
            }

            editItem(id) {
                const item = this.items.find(i => i.id === id);
                if (item) {
                    this.editingId = id;
                    this.dom.nameInput.value = item.name;
                    this.dom.valueInput.value = item.value;
                    this.dom.rateInput.value = item.rate || '';
                    this.dom.typeInput.value = item.type;
                    this.dom.categoryInput.value = item.category;

                    this.dom.submitBtn.textContent = 'Update';
                    this.dom.cancelBtn.style.display = 'inline-block';
                    window.scrollTo({ top: this.dom.form.offsetTop - 100, behavior: 'smooth' });
                }
            }

            cancelEdit() {
                this.editingId = null;
                this.dom.form.reset();
                this.dom.submitBtn.textContent = '+';
                this.dom.cancelBtn.style.display = 'none';
            }

            deleteItem(id) {
                if (this.editingId === id) {
                    this.cancelEdit();
                }
                this.items = this.items.filter(item => item.id !== id);
                this.save();
                this.render();
            }

            save(skipPush = false) {
                localStorage.setItem('wealth_items', JSON.stringify(this.items));
                if (!skipPush) {
                    this.pushToSheet();
                }
            }

            resetData() {
                if (confirm('Are you sure you want to clear all data?')) {
                    this.items = [];
                    this.cancelEdit();
                    this.save();
                    this.render();
                }
            }

            exportToCSV() {
                if (this.items.length === 0) {
                    alert('No data to export!');
                    return;
                }

                const headers = ['ID', 'Name', 'Value', 'Interest Rate (%)', 'Type', 'Category', 'Date'];
                const rows = this.items.map(item => [
                    item.id,
                    `"${item.name.replace(/"/g, '""')}"`, // Escape quotes
                    item.value,
                    item.rate || 0,
                    item.type,
                    item.category,
                    item.date
                ]);

                const csvContent = [
                    headers.join(','),
                    ...rows.map(row => row.join(','))
                ].join('\n');

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', `wealth_data_${new Date().toISOString().slice(0, 10)}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            calculateTotals() {
                let assets = 0;
                let liabilities = 0;

                this.items.forEach(item => {
                    if (item.type === 'asset') assets += item.value;
                    else liabilities += item.value;
                });

                return {
                    assets,
                    liabilities,
                    netWorth: assets - liabilities
                };
            }

            calculateProjectionData() {
                const years = 10;
                const data = {
                    labels: [],
                    netWorth: [],
                    assets: [],
                    liabilities: []
                };

                for (let year = 0; year <= years; year++) {
                    let futureAssets = 0;
                    let futureLiabilities = 0;

                    this.items.forEach(item => {
                        const rate = (item.rate || 0) / 100;
                        const futureValue = item.value * Math.pow((1 + rate), year);

                        if (item.type === 'asset') {
                            futureAssets += futureValue;
                        } else {
                            futureLiabilities += futureValue;
                        }
                    });

                    data.labels.push(year === 0 ? 'Today' : `Year ${year}`);
                    data.assets.push(futureAssets);
                    data.liabilities.push(futureLiabilities);
                    data.netWorth.push(futureAssets - futureLiabilities);
                }
                return data;
            }

            getCategoryBreakdown() {
                const breakdown = {};
                this.items.forEach(item => {
                    // For the chart, we might want to visualize assets primarily, or both.
                    // Let's visualize just Assets allocation for now as is typical.
                    if (item.type === 'asset') {
                        if (!breakdown[item.category]) breakdown[item.category] = 0;
                        breakdown[item.category] += item.value;
                    }
                });
                return breakdown;
            }

            updateChart(breakdown) {
                const labels = Object.keys(breakdown);
                const data = Object.values(breakdown);

                // Destroy old chart if exists
                if (this.chart) {
                    this.chart.destroy();
                }

                // If no assets, show empty state or nothing
                if (labels.length === 0) return;

                const ctx = this.dom.chartCanvas.getContext('2d');

                // Custom plugin to draw text in center (optional, keeping simple for now)

                this.chart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: [
                                '#10b981', '#3b82f6', '#f59e0b', '#8b5cf6', '#ec4899', '#6366f1',
                                '#14b8a6', '#f97316', '#06b6d4', '#84cc16', '#d946ef', '#e11d48',
                                '#22d3ee', '#a8a29e'
                            ],
                            borderWidth: 0,
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#94a3b8',
                                    usePointStyle: true,
                                    padding: 20
                                }
                            }
                        },
                        cutout: '70%'
                    }
                });
            }

            renderProjectionChart(data) {
                if (this.projChart) {
                    this.projChart.destroy();
                }

                const ctx = this.dom.projChartCanvas.getContext('2d');

                // Create gradients
                const gradientNetWorth = ctx.createLinearGradient(0, 0, 0, 400);
                gradientNetWorth.addColorStop(0, 'rgba(15, 23, 42, 0.2)'); // Navy with opacity
                gradientNetWorth.addColorStop(1, 'rgba(15, 23, 42, 0.0)');

                this.projChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.labels,
                        datasets: [
                            {
                                label: 'Net Worth',
                                data: data.netWorth,
                                borderColor: '#0F172A', // Navy
                                backgroundColor: gradientNetWorth,
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'Assets',
                                data: data.assets,
                                borderColor: '#059669', // Emerald
                                borderDash: [5, 5],
                                tension: 0.4,
                                hidden: true // Hide by default to reduce clutter, can be toggled
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: {
                            legend: {
                                labels: { color: '#57534E' } // Stone Gray
                            },
                            tooltip: {
                                backgroundColor: '#FFFFFF',
                                titleColor: '#1C1917',
                                bodyColor: '#57534E',
                                borderColor: '#E7E5E4',
                                borderWidth: 1,
                                padding: 10,
                                callbacks: {
                                    label: (context) => {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += this.currencyFormatter.format(context.parsed.y);
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                grid: { color: 'rgba(0, 0, 0, 0.05)' },
                                ticks: { color: '#57534E' }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: '#57534E' }
                            }
                        }
                    }
                });
            }

            renderProjectionTable(data) {
                this.dom.projTableBody.innerHTML = '';
                // Show Year 1, 3, 5, 10
                const yearsToShow = [1, 3, 5, 10];

                yearsToShow.forEach(year => {
                    // +1 because index 0 is Today
                    if (year < data.labels.length) {
                        const currentVal = data.netWorth[year];
                        const prevVal = data.netWorth[0]; // Compare to today
                        const growth = currentVal - prevVal;
                        const growthPercent = prevVal !== 0 ? (growth / Math.abs(prevVal)) * 100 : 0;

                        const tr = document.createElement('tr');
                        tr.style.borderBottom = '1px solid var(--border-color)';
                        tr.innerHTML = `
                            <td style="padding: 0.75rem 0; color: var(--text-primary);">Year ${year}</td>
                            <td style="padding: 0.75rem 0; text-align: right; font-weight: 600;">${this.currencyFormatter.format(currentVal)}</td>
                            <td style="padding: 0.75rem 0; text-align: right; color: ${growth >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">
                                ${growth >= 0 ? '+' : ''}${this.currencyFormatter.format(growth)} <span style="font-size:0.75rem; opacity:0.8;">(${growthPercent.toFixed(1)}%)</span>
                            </td>
                        `;
                        this.dom.projTableBody.appendChild(tr);
                    }
                });
            }

            render() {
                // 1. Render List
                this.dom.list.innerHTML = '';
                this.items.sort((a, b) => b.value - a.value).forEach(item => {
                    const li = document.createElement('li');
                    li.className = `item ${item.type}`;
                    const rateText = item.rate ? `<span style="margin-left:0.5rem; font-size:0.75rem; color:var(--text-secondary); background:rgba(255,255,255,0.1); padding:2px 6px; border-radius:4px;">${item.rate}% APY</span>` : '';

                    li.innerHTML = `
                    <div class="item-info">
                        <h4>${item.name} ${rateText}</h4>
                        <span>${item.category}</span>
                    </div>
                    <div class="item-actions">
                        <span class="item-price" style="color: ${item.type === 'asset' ? 'var(--accent-green)' : 'var(--accent-red)'}">
                            ${item.type === 'liability' ? '-' : ''}${this.currencyFormatter.format(item.value)}
                        </span>
                        <div>
                            <button class="btn-edit" onclick="app.editItem(${item.id})">✎</button>
                            <button class="btn-delete" onclick="app.deleteItem(${item.id})">×</button>
                        </div>
                    </div>
                `;
                    this.dom.list.appendChild(li);
                });

                // 2. Update Totals
                const totals = this.calculateTotals();
                this.dom.netWorth.textContent = this.currencyFormatter.format(totals.netWorth);
                this.dom.assets.textContent = this.currencyFormatter.format(totals.assets);
                this.dom.liabilities.textContent = this.currencyFormatter.format(totals.liabilities);

                // 3. Update Projections (Chart & Table)
                const projectionData = this.calculateProjectionData();
                this.renderProjectionChart(projectionData);
                this.renderProjectionTable(projectionData);

                // 4. Update Chart
                const breakdown = this.getCategoryBreakdown();
                this.updateChart(breakdown);

                // 5. Update Insights
                if (totals.assets > 0) {
                    const ratio = ((totals.assets - totals.liabilities) / totals.assets) * 100;
                    this.dom.insightText.innerHTML = `
                    Your Net Worth is <strong>${ratio.toFixed(1)}%</strong> of your total assets. 
                    ${totals.liabilities > 0 ? `You have a debt-to-asset ratio of <strong>${((totals.liabilities / totals.assets) * 100).toFixed(1)}%</strong>.` : 'You are currently debt-free. Great work!'}
                `;
                } else {
                    this.dom.insightText.textContent = "Start adding assets to see insights about your financial health.";
                }
            }
        }

        // Initialize App
        const app = new WealthApp();
    </script>

</body>

</html>

